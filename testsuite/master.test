#! /bin/sh

# Copyright (C) 2001 by Martin Pool <mbp@samba.org>

# rsync top-level test script -- this invokes all the other more
# detailed tests in order.  This script can either be called by 'make
# check' or through 'runlist' from the build farm.

# We need a few environment variables to know what to test.

echo "============================================================"
echo "$0 running"

test_names="rsync-hello hands"

export rsync_bin
export testdir

skipped=0
missing=0
passed=0
failed=0

testsrcdir="`pwd`"

for testbase in $test_names
do
    testscript="$testsrcdir/$testbase.test"
    if test \! -f "$testscript" 
    then
	echo "$testscript does not exist" >&2
	missing=`expr $missing + 1`
	continue
    fi

    echo "------------------------------------------------------------"
    echo "----- $testbase running"

    if sh $testscript
    then
	echo "----- $testbase completed succesfully"
	passed=`expr $passed + 1`
    else
	echo "----- $testbase failed!"
	failed=`expr $failed + 1`
    fi	
done

echo '------------------------------------------------------------'
echo "----- overall results:"
echo "      $passed passed"
echo "      $failed failed"
echo "      $skipped skipped"
echo "      $missing missing"
echo '------------------------------------------------------------'
