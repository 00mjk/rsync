NEWS for rsync 2.6.9 (unreleased)
Protocol: 29 (unchanged)
Changes since 2.6.8:

  BUG FIXES:

    - If rsync is interrupted via a handled signal (such as SIGINT), it will
      once again clean-up its temp file from the destination dir.

    - An rsync daemon that is receiving files with "use chroot = no" no longer
      sanitizes the symlink target strings.  This means that each symlink's
      value will now be accepted (and thus returned) with its symlink info
      intact.  Also, in order to keep things safe, all arg paths and any
      dereferenced symlinks (e.g. via --copy-links or --keep-dirlinks) are
      manually verified to ensure that no symlinks try to escape past the top
      of the module's path.  These changes make a non-chroot daemon behave the
      same way as a chroot daemon with regard to symlinks, and also avoids a
      potential problem where a pre-existing symlink could have escaped the
      module's hierarchy.  See also the new "munge symlinks" daemon setting.

    - Fixed an overzealous sanitizing bug in the handling of the --link-dest,
      --copy-dest, and --compare-dest options to a daemon without chroot: if
      the copy's destination dir is deeper than the top of the module's path,
      these options now accept a safe number of ../ (parent-dir) references
      (since these options are relative to the destination dir).  The old code
      incorrectly chopped off all "../" prefixes for these options, no matter
      how deep the destination directory was in the module's hierarchy.

    - Fixed a bug where a deferred info/error/log message could get sent
      directly to the sender instead of being handled by rwrite() in the
      generator.  This fixes an "unexpected tag 3" fatal error, and should
      also fix a potential problem where a deferred info/error message from
      the receiver might bypass the log file and get sent only to the client
      process.  (These problems could only affect an rsync daemon that was
      receiving files.)

    - Fixed a bug in the %f logfile escape when receiving files: the
      destination path is now included in the output (e.g. you can now tell
      when a user specifies a subdir inside a module).

    - If the receiving side fails to create a directory, it will now skip
      trying to update everything that is inside that directory.

    - Make sure that the --link-dest option can still do its job even when -I
      is specified.

    - If --link-dest is specified with --checksum but without --times, rsync
      will now allow a hard-link to be created to a matching link-dest file
      even when the file's modify-time doesn't match the server's file.

    - The daemon now calls more timezone-using functions prior to doing a
      chroot.  This should help some C libraries to generate proper timestamps
      from inside a chrooted daemon (and to not try to access /etc/timezone
      over and over again).

    - Fixed a bug in the handling of an absolute --partial-dir=ABS_PATH option:
      it now deletes an alternate basis file from the partial-dir that was used
      to successfully update a destination file.

  ENHANCEMENTS:

    - Added the --log-file=FILE and --log-file-format=FORMAT options.  These
      can be used to tell any rsync to output what it is doing to a log file.
      They work with a client rsync, a non-daemon server rsync (see the man
      page for instructions), and also allows the overriding of rsyncd.conf
      settings when starting a daemon.

    - The --log-format option was renamed to be --out-format to avoid confusing
      it with affecting the log-file output.  (The old option remains as an
      alias for the new to preserve backward compatibility.)

    - Made "log file" and "syslog facility" settable on a per-module basis in
      the daemon's config file.

    - Added the "munge symlinks" daemon setting to enable the old-style
      tweaking of "unsafe" symlinks, regardless of how "use chroot" is set.

  DEVELOPER RELATED:

    - The acls.diff and xattrs.diff patches have received a bunch of work to
      make them much closer to being acceptable in the main distribution.

    - Updated config.guess and config.sub to their 2006-02-23 version.

    - Updated various files to include the latest FSF address and to have
      consistent opening comments.
